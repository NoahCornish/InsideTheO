name: Run OHL Roster Scraper

on:
  schedule:
    # Run daily at 20:15 UTC (15:15 Toronto time during EST)
    - cron: "15 20 * * *"
  workflow_dispatch:

jobs:
  run_roster_scraper:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the repository
      - name: Checkout repository
        uses: actions/checkout@v3

      # Step 2: Set up Python environment
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: 3.12.1

      # Step 3: Install dependencies
      - name: Install dependencies
        run: pip install -r requirements.txt

      # Step 4: Run the Roster Scraper
      - name: Run the Roster Scraper
        run: |
          python get_rosters.py

      # Step 5: Create Folder if Not Exists
      - name: Create Folder
        run: mkdir -p OHL_ROSTERS_TEST

      # Step 6: Check for Changes
      - name: Check for Changes
        run: |
          if [ -f OHL_ROSTERS_TEST/OHL_ROSTERS_2024_2025.csv ]; then
            if cmp -s OHL_ROSTERS_2024_2025.csv OHL_ROSTERS_TEST/OHL_ROSTERS_2024_2025.csv; then
              echo "NO CHANGES TO OHL ROSTERS IN THIS UPDATE";
              exit 0;
            fi
          fi

      # Step 7: Move the New File to the Folder
      - name: Move New CSV File
        run: mv OHL_ROSTERS_2024_2025.csv OHL_ROSTERS_TEST/

      # Step 8: Commit and Push Changes
      - name: Commit and Push Changes
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add OHL_ROSTERS_TEST/OHL_ROSTERS_2024_2025.csv
          git commit -m "Automated update: OHL Rosters CSV"
          git push
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
